import{r as b,_ as z,a as y,o as j,c as A,w as n,b as w,d as o,e as a,u as P,g as G,f as K,h as Q,i as r,j as v,t as c,k as $,l as W,F as X,m as x,n as Y,E as p,p as Z,q as U}from"./index.e7310cac.js";const ee=l=>b.get(`/comment/getCommentsByBlogId?id=${l}`),te=l=>b.post(`/comment/addHeartNum?id=${l}`),S=l=>b.get(`/comment/getImageByUsername?username=${l}`),ae=(l,m,d)=>b.post(`/comment/addComment?blogId=${l}&username=${m}&content=${d}`),se=l=>b.post(`/comment/deleteComment?id=${l}`);const oe={class:"blog-header"},ne={class:"publish-time"},le={class:"blog-author-info"},re={class:"author-name"},ce=["innerHTML"],ie={class:"comments-header"},de={class:"add-comment-section"},ue={class:"comment-input-container"},me={class:"comment-actions-bar"},_e={class:"comments-content"},ve={class:"comment-user"},pe={key:0},ge={class:"user-info"},he={class:"username"},fe={class:"create-time"},ye={class:"comment-content"},we={class:"comment-actions"},be={key:0,class:"no-comments"},Ie={key:1,class:"loading-container"},ke={__name:"blogDetail",setup(l){const m=JSON.parse(localStorage.getItem("loginUser")),d=P(),u=y(null),g=y([]),_=y(""),C=y({}),h=y(!1),B=async t=>{const e=await ee(t);g.value=await Promise.all(e.data.map(async f=>{try{const k=await S(f.username);return{...f,avatar:k.data||""}}catch{return{...f,avatar:""}}}));const i=await G(t);u.value=i.data;const I=await K(t);C.value=I.data,await H()},D=async t=>{await te(t.id),t.heartNum+=1},F=async t=>{(await se(t.id)).code?(p.success("\u5220\u9664\u6210\u529F"),await B(d.params.id)):p.error("\u5220\u9664\u5931\u8D25")},V=async()=>{const t={userId:JSON.parse(localStorage.getItem("loginUser")).id,followId:u.value.userId};(await Y(t)).code?(p.success("\u5173\u6CE8\u6210\u529F"),h.value=!0):p.error("\u5173\u6CE8\u5931\u8D25")},T=async()=>{const t={userId:JSON.parse(localStorage.getItem("loginUser")).id,followId:u.value.userId};(await Z(t)).code?(p.success("\u53D6\u6D88\u5173\u6CE8\u6210\u529F"),h.value=!1):p.error("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25")},H=async()=>{const t=await Q(m.id);for(let e=0;e<t.data.length;e++)if(t.data[e]===C.value.id){h.value=!0;return}},L=async()=>{if(!!_.value.trim())try{const e=(await ae(d.params.id,m.username,_.value)).data;_.value="";try{const i=await S(e.username);e.newField="avatar",e.avatar=i.data,B(d.params.id)}catch{e.avatar=""}g.value.unshift(e)}catch(t){console.error("\u63D0\u4EA4\u8BC4\u8BBA\u5931\u8D25:",t)}};return j(()=>{const t=d.params.id;B(t)}),(t,e)=>{const i=r("el-button"),I=r("el-card"),f=r("el-input"),k=r("el-avatar"),M=r("Star"),N=r("el-icon"),E=r("Delete"),J=r("el-main"),O=r("el-container"),R=r("el-spinner");return u.value?(v(),A(O,{key:0,class:"blog-container"},{default:n(()=>[o(J,null,{default:n(()=>[o(I,{shadow:"hover",class:"blog-card"},{header:n(()=>[a("div",oe,[a("h1",null,c(u.value.title),1),a("p",ne,"\u53D1\u5E03\u65F6\u95F4\uFF1A"+c(u.value.createTime),1),a("div",le,[a("span",re,"\u4F5C\u8005: "+c(C.value.username),1),o(i,{type:"primary",size:"small",onClick:e[0]||(e[0]=s=>h.value?T():V()),class:"follow-button"},{default:n(()=>[$(c(h.value?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8"),1)]),_:1})])])]),default:n(()=>[a("div",{class:"blog-content",innerHTML:u.value.content},null,8,ce)]),_:1}),o(I,{shadow:"hover",class:"comments-card"},{header:n(()=>[a("div",ie,[a("h2",null,"\u8BC4\u8BBA ("+c(g.value.length)+")",1)])]),default:n(()=>[a("div",de,[a("div",ue,[o(f,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u60A8\u7684\u8BC4\u8BBA...",rows:3,class:"comment-textarea"},null,8,["modelValue"]),a("div",me,[o(i,{type:"primary",onClick:L,disabled:!_.value.trim()},{default:n(()=>e[2]||(e[2]=[$(" \u53D1\u8868\u8BC4\u8BBA ")])),_:1,__:[2]},8,["disabled"])])])]),a("div",_e,[(v(!0),w(X,null,W(g.value,s=>(v(),w("div",{key:s.id,class:"comment-item"},[a("div",ve,[o(k,{size:50,src:s.avatar,class:"user-avatar"},{default:n(()=>[s.avatar?x("",!0):(v(),w("span",pe,c(s.username.charAt(0)),1))]),_:2},1032,["src"]),a("div",ge,[a("span",he,c(s.username),1),a("span",fe,c(s.createTime),1)])]),a("div",ye,c(s.content),1),a("div",we,[o(i,{type:"primary",link:"",onClick:q=>D(s)},{default:n(()=>[o(N,null,{default:n(()=>[o(M)]),_:1}),a("span",null,c(s.heartNum),1)]),_:2},1032,["onClick"]),o(i,{type:"danger",link:"",onClick:q=>F(s),style:{"margin-left":"10px"},disabled:U(m).username!==s.username&&U(m).username!==U(d).params.username},{default:n(()=>[o(N,null,{default:n(()=>[o(E)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128)),g.value.length===0?(v(),w("div",be," \u6682\u65E0\u8BC4\u8BBA ")):x("",!0)])]),_:1})]),_:1})]),_:1})):(v(),w("div",Ie,[o(R),e[3]||(e[3]=a("span",null,"\u52A0\u8F7D\u4E2D...",-1))]))}}},Be=z(ke,[["__scopeId","data-v-8b1ff301"]]);export{Be as default};
